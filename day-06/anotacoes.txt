VOLUMES
#######

Recurso do kubernetes responsavel pelo armazenamento de dados, sejam eles temporarios, enquanto o POD existir ou de forma
persistente, ou seja, mesmo que um POD seja removido, os dados que foram salvos enquanto ele estava ativo permanecerao
armazenados em um local preconfigurado na sua infraestrutura (Ex. HD do host, NFS, Cloud Provider etc...)

Volumes temporarios
###################

emptyDir    ==> Utilizado para compartilhamento de dados efemeros entre containers de um mesmo POD


Volumes Persistentes
####################

SC - Storage Class
++++++++++++++++++

E um objeto que descreve e define diferentes classes de armazenamento disponiveis no cluster. Essas classes de armazenamento 
podem ser usadas para provisionar dinamicamente PersistentVolumes (PVs) de acordo com os requisitos dos PersistentVolumeClaims 
(PVCs) criados pelos usuarios.

Tambem e util para gerenciar e organizar diferentes tipos de armazenamento, como armazenamento em disco rapido e caro ou 
armazenamento em disco mais lento e barato. Alem disso, pode ser usado para definir diferentes politicas de retençao, 
provisionamento e outras caracteristicas de armazenamento especificos.

Cada StorageClass e definido com um provisionador, que e responsavel por criar PersistentVolumes dinamicamente conforme necessário. 
Os provisionadores podem ser internos (fornecidos pelo proprio Kubernetes) ou externos (fornecidos por provedores de armazenamento 
especificos).

OBS: Caso voce necessite criar um Storage Class para teste ou estudo e uma boa pratica definir o Provisioner com o valor padrao
kubernetes.io/no-provisioner.

IMPORTANTE
##########

Ao criar o primeiro StorageClass ele sera definido como padrao a menos que no manifesto esteja definido o valor "false" para o 
parametro IsDefaultClass.

Um StorageClass definido como padrao fara que todos os PersistentVolumeClaims que nao tiverem um Storage Class definido o utilize
como padrao.


PV - Persistent Volume
++++++++++++++++++++++

E um objeto que representa um recurso de armazenamento fisico em um cluster Kubernetes. Ele pode ser um disco rigido em um no do cluster, 
um dispositivo de armazenamento em rede (NAS) ou mesmo um serviço de armazenamento em nuvem.

E utilizado para fornecer armazenamento duravel, ou seja, os dados armazenados no PV permanecem disponiveis mesmo quando o POD e 
reiniciado ou movido para outro no.

Existem dois tipos de armazenamento via PV:

    Local           ==> HostPath 
    Rede            ==> NFS, iSCSI, Ceph RBD, GlusterFS, Cloud

Manifesto Exemplo
+++++++++++++++++

apiVersion: v1 # Versão da API do Kubernetes
kind: PersistentVolume # Tipo de objeto que estamos criando, no caso um PersistentVolume
metadata: # Informações sobre o objeto
  name: meu-pv # Nome do nosso PV
  labels:
    storage: local
spec: # Especificaçoes do nosso PV
  capacity: # Capacidade do PV
    storage: 1Gi # 1 Gigabyte de armazenamento
  accessModes: # Modos de acesso ao PV
    - ReadWriteOnce # Modo de acesso ReadWriteOnce, ou seja, o PV pode ser montado como leitura e escrita por um unico no
  persistentVolumeReclaimPolicy: Retain # Politica de reivindicaçao do PV, ou seja, o PV nao sera excluido quando o PVC for excluido
  hostPath: # Tipo de armazenamento que vamos utilizar, no caso um hostPath
    path: "/mnt/data" # Caminho do hostPath, do nosso no, onde o PV sera criado
  storageClassName: standard # Nome da classe de armazenamento que sera utilizada


Outras possibilidades de confguraçao

  accessModes
        ReadWriteOnce   => O PV pode ser montado como leitura e escrita por um unico no
        ReadOnlyMany    => O PV pode ser montado como somente leitura por varios nos
        ReadWriteMany   => O PV pode ser montado como leitura e escrita por varios nos

  persistentVolumeReclaimPolicy: 
        Retain          => O PV nao sera excluido quando o PVC for excluido
        Recycle         => O PV sera excluido quando o PVC for excluido, mas antes disso todos os dados serao apagados
        Delete          => O PV sera excluido quando o PVC for excluido


PVC - Persistent Volume Claim
+++++++++++++++++++++++++++++

E uma solicitaçao de armazenamento feita pelos usuarios ou aplicativos no cluster Kubernetes. Ele permite que os usuarios solicitem um 
volume especifico, com base em tamanho, tipo de armazenamento e outras caracteristicas. 
O PVC age como uma "assinatura" que reivindica um PV para ser usado por um container. O Kubernetes tenta associar automaticamente um PVC 
a um PV compativel, garantindo que o armazenamento seja alocado corretamente.

Todo PVC e associado a um Storage Class ou a um Persistent Volume. O Storage Class e um objeto que descreve e define diferentes classes 
de armazenamento disponiveis no cluster. 
Ja o Persistent Volume e um recurso que representa um volume de armazenamento disponivel para ser usado pelo cluster.


Manifesto Exemplo
+++++++++++++++++

apiVersion: v1 # versão da API do Kubernetes
kind: PersistentVolumeClaim # tipo de recurso, no caso, um PersistentVolumeClaim
metadata: # metadados do recurso
  name: meu-pvc # nome do PVC
spec: # especificaçao do PVC
  accessModes: # modo de acesso ao volume
    - ReadWriteOnce # modo de acesso RWO, ou seja, somente leitura e escrita por um no
  resources: # recursos do PVC
    requests: # solicitaçao de recursos
      storage: 1Gi # tamanho do volume que ele vai solicitar
  storageClassName: nfs # nome da classe de armazenamento que sera utilizado
  selector: # seletor de labels
    matchLabels: # labels que serao utilizadas para selecionar o PV
      storage: nfs # label que sera utilizada para selecionar o PV
